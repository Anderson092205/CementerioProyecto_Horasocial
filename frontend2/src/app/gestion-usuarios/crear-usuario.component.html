<div class="container mt-5">
  <div class="card shadow">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h3 class="mb-0">Registrar Nuevo Usuario</h3>
      <span class="badge bg-info text-dark">츼rea Inform치tica</span>
    </div>
    
    <div class="card-body">
      <div *ngIf="mensajeExito" class="alert alert-success"> {{ mensajeExito }} </div>
      <div *ngIf="mensajeError" class="alert alert-danger"> {{ mensajeError }} </div>

      <form #userForm="ngForm" (ngSubmit)="userForm.form.valid && onSubmit()">
        
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Nombre Completo</label>
            <input type="text" [(ngModel)]="nuevoUsuario.nombre" name="nombre" class="form-control" required #nombre="ngModel" [class.is-invalid]="nombre.invalid && nombre.touched">
            <div *ngIf="nombre.invalid && nombre.touched" class="text-danger small mt-1">* Campo obligatorio</div>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Correo Electr칩nico</label>
            <input type="email" [(ngModel)]="nuevoUsuario.correo" name="correo" class="form-control" required email #correo="ngModel" [class.is-invalid]="correo.invalid && correo.touched">
            <div *ngIf="correo.invalid && correo.touched" class="text-danger small mt-1">* Ingrese un correo v치lido</div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Tel칠fono</label>
            <input type="text" [(ngModel)]="nuevoUsuario.telefono" name="telefono" class="form-control" maxlength="9" required (input)="aplicarMascara($event)" #tel="ngModel" [class.is-invalid]="tel.invalid && tel.touched">
            <div *ngIf="tel.invalid && tel.touched" class="text-danger small mt-1">* Formato: 0000-0000</div>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Asignar Rol</label>
            <select [(ngModel)]="nuevoUsuario.idRol" name="idRol" class="form-select" required #rol="ngModel" [class.is-invalid]="rol.invalid && rol.touched">
              <option [value]="1">ADMINISTRADOR</option>
              <option [value]="2">OPERADOR</option>
              <option [value]="3">CONSULTA</option>
              <option [value]="4">INFORMATICA</option>
            </select>
          </div>
        </div>

       <div class="row mb-3" *ngIf="nuevoUsuario.idRol != 1">
  <div class="col-md-12">
    <label class="form-label">Asignar Cementerios</label>
    <div class="p-3 rounded border" style="background-color: #fffafb; border-color: #ffc0cb !important;">
      <div class="row">
        <div *ngFor="let c of listaCementerios" class="col-md-4 mb-2">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" 
                   [id]="'cem-' + c.id" 
                   (change)="onCheckboxChange($event, c.id)"
                   style="border-color: #d73387;">
            <label class="form-check-label" [for]="'cem-' + c.id">
              {{ c.nombre }}
            </label>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="nuevoUsuario.idCementerios.length === 0 && rol.touched" class="text-danger small mt-1">
      * Seleccione al menos un cementerio de acceso.
    </div>
  </div>
</div>
        <div class="mb-4">
          <label class="form-label">Contrase침a Temporal</label>
          <div class="input-group">
            <input type="text" [(ngModel)]="nuevoUsuario.contrasena" name="contrasena" class="form-control" required #pass="ngModel" [class.is-invalid]="pass.invalid && pass.touched">
            <button class="btn btn-secondary" type="button" (click)="generarPassword()">Generar 游</button>
            <button class="btn btn-outline-primary" type="button" (click)="copiarPassword()" [disabled]="!nuevoUsuario.contrasena">Copiar 游늶</button>
          </div>
          <div *ngIf="pass.invalid && pass.touched" class="text-danger small mt-1">* Debe generar o escribir una contrase침a</div>
        </div>

        <div class="d-flex justify-content-end gap-2 border-top pt-3">
          <button type="button" class="btn btn-light" (click)="cancelar()">Cancelar</button>
          <button type="submit" class="btn btn-success px-4" [disabled]="userForm.invalid">Guardar Usuario</button>
        </div>
      </form>
    </div>
  </div>
</div>